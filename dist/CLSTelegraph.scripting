{"name":"\u8d22\u8054\u793e\u7535\u62a5","icon":"newspaper.fill","color":"D63434","summary":"\u5b9e\u65f6\u83b7\u53d6\u8d22\u8054\u793e\u91d1\u878d\u5feb\u8baf","type":"2","version":"1.0.0","script":"// @file: index.tsx\n/**\n * @name \u8d22\u8054\u793e\u7535\u62a5\n * @description 7x24\u5c0f\u65f6\u8d22\u7ecf\u5feb\u8baf\n */\n\ntype NewsItem = {\n  id: number;\n  title: string;\n  content: string;\n  ctime: number;\n  subjects: { subject_name: string }[];\n};\n\n// \u8f85\u52a9\u51fd\u6570\nconst fmtTime = (ts: number) => {\n  const d = new Date(ts * 1000);\n  return `${d.getHours()\u3002toString()\u3002padStart(2\uff0c\"0\")}:${d.getMinutes()\u3002toString().padStart(2,\"0\")}`;\n};\n\nconst clean = (t: string) => t.replace(/<[^>]+>/g, \"\").trim();\n\n// API \u8bf7\u6c42\nconst fetchNews = async (): Promise<NewsItem[]> => {\n  try {\n    const res = await fetch(\"https://www.cls.cn/nodeapi/telegraphList?rn=30\");\n    const json = (await res.json()) as { data: { roll_data: NewsItem[] } };\n    return json.data.roll_data || [];\n  } catch (e) {\n    console.error(e);\n    return [];\n  }\n};\n\n// \u5355\u884c\u7ec4\u4ef6\nconst Row = ({ item }: { item: NewsItem }) => (\n  <\u94fe\u63a5 url={`https://www.cls.cn/detail/${item.id}`}>\n    <HStack alignment=\"top\" spacing={10}>\n      {/* \u5de6\u4fa7\u65f6\u95f4\u8f74 */}\n      <VStack alignment=\"trailing\" spacing={0} width={40}>\n        <Text font=\"caption2\" color={Color.gray} weight=\"bold\">{fmtTime(item.ctime)}</Text>\n        <Circle width={6} height={6} color={Color.red} padding={{ top: 4 }} />\n      </VStack>\n      \n      {/* \u53f3\u4fa7\u5185\u5bb9 */}\n      <VStack alignment=\"leading\" spacing={4}>\n        {item.title\u3002length > 0 && (\n          <Text font=\"subheadline\" weight=\"bold\" lineLimit={2}>{item.title}</Text>\n        )}\n        <Text font=\"footnote\" color={item.title ? Color.gray : Color.primary} lineLimit={4}>\n          {clean(item.content)}\n        </Text>\n        \n        {/* \u6807\u7b7e */}\n        {item.subjects?.length > 0 && (\n          <HStack spacing={4}>\n            {item.subjects.map((s, i) => (\n              <Text key={i.toString()} font=\"caption2\" color={Color.blue} background={Color.blue.opacity(0.1)} cornerRadius={2} padding={2}>\n                {s.subject_name}\n              </Text>\n            ))}\n          </HStack>\n        )}\n      </VStack>\n    </HStack>\n  </\u94fe\u63a5>\n);\n\n// \u4e3b\u5e94\u7528\nconst App = () => {\n  const [list\uff0c setList] = useState<NewsItem[]>([]);\n  const [load\uff0c setLoad] = useState(true);\n\n  const refresh = async () => {\n    setLoad(true);\n    setList(await fetchNews());\n    setLoad(false);\n  };\n\n  useEffect(() => { refresh(); }\uff0c []);\n\n  return (\n    <List isLoading={load}>\n      <HStack padding={10}>\n        <Image systemName=\"newspaper.fill\" color={Color.red} />\n        <Text weight=\"bold\">\u8d22\u8054\u793e\u7535\u62a5</Text>\n        <Spacer />\n        <Button action={refresh}>\n          <Image systemName=\"arrow.clockwise\" color={Color.blue} />\n        </Button>\n      </HStack>\n      {list.map(i => <Row key={i.id.toString()} item={i} />)}\n    </List>\n  );\n};\n\n// \u5165\u53e3\nNavigation.present(<App />);\n"}